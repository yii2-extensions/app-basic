on:
  pull_request:
    paths-ignore:
      - 'docs/**'
      - 'README.md'
      - 'CHANGELOG.md'
      - '.gitignore'
      - '.gitattributes'
      - 'infection.json.dist'
      - 'psalm.xml'

  push:
    paths-ignore:
      - 'docs/**'
      - 'README.md'
      - 'CHANGELOG.md'
      - '.gitignore'
      - '.gitattributes'
      - 'infection.json.dist'
      - 'psalm.xml'

name: build

jobs:
  codeception:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: composer install

      - name: Download and configure Selenium and Chrome
        run: |
          wget -c -nc --retry-connrefused --tries=0 https://github.com/SeleniumHQ/selenium/releases/download/selenium-4.14.0/selenium-server-4.14.1.jar -O selenium-server-standalone.jar
          java -jar selenium-server-standalone.jar -port 9515 & sleep 1;
          wget https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/118.0.5993.88/linux64/chromedriver-linux64.zip
          sudo apt-get install unzip
          unzip -o -q chromedriver-linux64.zip
          cd chromedriver-linux64
          chromedriver --port=9515 --url-base=wd/hub/ > /dev/null 2>&1&
          cd ..
          echo google-chrome --product-version

      - name: Run Codeception
        run: |
          php -S 127.0.0.1:8080 -t public > /dev/null 2>&1&
          vendor/bin/codecept run
